<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Megawheel Tracker PRO - Stats Avanc√©es</title>
    <style>
        :root { --primary: #007bff; --success: #28a745; --warning: #ffc107; --danger: #dc3544; --dark: #343a40; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #f4f7f6; padding: 10px; color: #333; }
        .container { max-width: 600px; margin: auto; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: var(--dark); margin-bottom: 20px; }
        
        /* Onglets */
        .tabs { display: flex; justify-content: space-between; margin-bottom: 15px; background: #eee; padding: 5px; border-radius: 8px; }
        .tab-btn { flex: 1; padding: 10px; border: none; cursor: pointer; background: none; font-weight: bold; transition: 0.3s; border-radius: 5px; }
        .tab-btn.active { background: white; box-shadow: 0 2px 5px rgba(0,0,0,0.1); color: var(--primary); }

        select { width: 100%; padding: 12px; margin-bottom: 15px; border-radius: 8px; border: 1px solid #ddd; font-size: 16px; }
        
        .grid-btns { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .btn { padding: 12px; border: none; border-radius: 8px; color: white; font-weight: bold; cursor: pointer; transition: all 0.2s; }
        .btn:active { transform: scale(0.98); }
        .add { background: var(--success); }
        .pred { background: var(--primary); }
        .chart { background: var(--warning); color: #000; }
        .reset { background: var(--danger); width: 100%; margin-top: 10px; }

        .box { background: #f9f9f9; padding: 15px; border-radius: 10px; margin-top: 15px; border-left: 5px solid var(--primary); }
        .res-scroll { display: flex; gap: 8px; overflow-x: auto; padding: 10px 0; font-weight: bold; }
        .res-item { background: var(--dark); color: white; padding: 5px 10px; border-radius: 5px; min-width: 30px; text-align: center; }
        
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        .stat-card { background: white; padding: 10px; border-radius: 8px; border: 1px solid #eee; text-align: center; }
        .stat-val { display: block; font-size: 20px; font-weight: bold; color: var(--primary); }
    </style>
</head>
<body>

<div class="container">
    <h2>üéØ Megawheel Tracker PRO</h2>

    <select id="numero">
        <option value="">S√©lectionner le r√©sultat</option>
        <script>
            [1,2,5,8,10,15,20,30,40].forEach(v => document.write(`<option value="${v}">${v}</option>`));
        </script>
    </select>

    <div class="grid-btns">
        <button class="btn add" onclick="ajouter()">‚ûï Ajouter</button>
        <button class="btn pred" onclick="analyser5000()">üîç Analyse 5k</button>
        <button class="btn chart" onclick="simulation(100)">üìä Simu +100</button>
    </div>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab(24, this)">Derni√®res 24h</button>
        <button class="tab-btn" onclick="switchTab(48, this)">48h (Ancien)</button>
        <button class="tab-btn" onclick="switchTab(72, this)">72h (Archive)</button>
    </div>

    <div class="box">
        <h3>Historique (<span id="count">0</span>/5000)</h3>
        <div id="historique" class="res-scroll"></div>
    </div>

    <div id="prediction-box" class="box" style="border-left-color: var(--success);">
        <h3>ü§ñ IA Pr√©diction (Bas√©e sur 5000)</h3>
        <div id="prediction-content">Ajoutez des donn√©es pour voir les probabilit√©s...</div>
    </div>

    <button class="btn reset" onclick="resetData()">üóë R√©initialiser toute la base</button>
</div>

<script>
    // Stockage : On garde 5000 r√©sultats
    let data = JSON.parse(localStorage.getItem("mw_data")) || [];
    let currentLimit = 24; // Filtre par d√©faut (simul√© par nombre de r√©sultats pour l'exemple)

    function save() {
        localStorage.setItem("mw_data", JSON.stringify(data));
    }

    function ajouter() {
        let val = document.getElementById("numero").value;
        if(!val) return;
        
        // Ajout avec timestamp pour g√©rer le temps plus tard si besoin
        data.unshift({ val: parseInt(val), time: Date.now() });
        
        // Limite stricte √† 5000
        if(data.length > 5000) data.pop();
        
        save();
        updateUI();
    }

    function switchTab(hours, btn) {
        currentLimit = hours;
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        updateUI();
    }

    function updateUI() {
        const histDiv = document.getElementById("historique");
        const countSpan = document.getElementById("count");
        
        // Simulation du filtrage par onglet (selon votre demande : 500 par tranches)
        let filtered = [];
        if(currentLimit === 24) filtered = data.slice(0, 500); 
        else if(currentLimit === 48) filtered = data.slice(500, 1000);
        else filtered = data.slice(1000, 1500);

        histDiv.innerHTML = filtered.map(d => `<div class="res-item">${d.val}</div>`).join('');
        countSpan.innerText = data.length;
    }

    function analyser5000() {
        if(data.length < 5) {
            alert("Pas assez de donn√©es pour une analyse fiable (min. 5)");
            return;
        }

        // Calcul des fr√©quences sur les 5000 r√©sultats
        let stats = {};
        data.forEach(d => stats[d.val] = (stats[d.val] || 0) + 1);

        let sorted = Object.entries(stats).sort((a,b) => b[1] - a[1]);
        let probable = sorted[0][0];
        let enRetard = sorted[sorted.length - 1][0];

        // D√©tection de pattern simple (les 3 derniers)
        let pattern = data.slice(0,3).map(d => d.val).join(" ‚Üí ");

        document.getElementById("prediction-content").innerHTML = `
            <div class="stat-grid">
                <div class="stat-card">Probabilit√©<span class="stat-val">${probable}</span></div>
                <div class="stat-card">En Retard<span class="stat-val">${enRetard}</span></div>
            </div>
            <p><strong>Dernier Pattern :</strong> ${pattern}</p>
            <p><small>Analyse bas√©e sur ${data.length} tours enregistr√©s.</small></p>
        `;
    }

    function simulation(n) {
        const possible = [1,2,5,8,10,15,20,30,40];
        for(let i=0; i<n; i++) {
            let rand = possible[Math.floor(Math.random() * possible.length)];
            data.unshift({ val: rand, time: Date.now() });
        }
        if(data.length > 5000) data = data.slice(0, 5000);
        save();
        updateUI();
    }

    function resetData() {
        if(confirm("Voulez-vous vraiment effacer les 5000 r√©sultats ?")) {
            data = [];
            save();
            updateUI();
        }
    }

    // Initialisation
    updateUI();
</script>
</body>
</html>
