<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MegaWheel Tracker 3D</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg: #121225;
            --card: #1c1c3a;
            --accent: #4ecca3;
            --text: #ffffff;
            --shadow: 6px 6px 12px #0a0a1a, -4px -4px 10px #2a2a5a;
            --inner: inset 3px 3px 7px #0a0a1a, inset -2px -2px 5px #2a2a5a;
        }

        body { font-family: sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 10px; }
        .container { max-width: 450px; margin: auto; background: var(--card); padding: 15px; border-radius: 25px; box-shadow: var(--shadow); }
        
        h2 { text-align: center; font-size: 1rem; color: var(--accent); margin-top: 0; }

        /* Saisie r√©trecie */
        .input-group { display: flex; gap: 8px; margin-bottom: 12px; }
        select { flex: 1; padding: 8px; border-radius: 10px; border: none; background: var(--bg); color: white; box-shadow: var(--inner); outline: none; }
        
        .btn { border: none; border-radius: 10px; font-weight: bold; cursor: pointer; transition: 0.2s; box-shadow: var(--shadow); font-size: 11px; padding: 10px; }
        .btn:active { transform: translateY(2px); box-shadow: var(--inner); }
        
        .add { background: var(--accent); color: #121225; width: 80px; }
        .pred { background: #3498db; color: white; flex: 1; }
        .simu { background: #e67e22; color: white; flex: 1; }
        .reset { background: #e74c3c; width: 100%; margin-top: 10px; font-size: 9px; opacity: 0.6; }

        .btn-row { display: flex; gap: 8px; margin-bottom: 12px; }

        /* Onglets */
        .tabs { display: flex; background: #0a0a1a; padding: 3px; border-radius: 12px; margin-bottom: 10px; }
        .tab-btn { flex: 1; border: none; background: none; color: #666; font-size: 10px; padding: 6px; cursor: pointer; border-radius: 10px; }
        .tab-btn.active { background: var(--card); color: var(--accent); box-shadow: 2px 2px 5px #000; }

        /* SECTION HISTORIQUE AGRANDIE */
        .box-history { 
            background: var(--bg); 
            border-radius: 15px; 
            padding: 10px; 
            margin-bottom: 12px; 
            box-shadow: var(--inner);
            height: 250px; /* Espace augment√© */
            overflow-y: auto;
        }
        .res-grid { display: grid; grid-template-columns: repeat(8, 1fr); gap: 4px; }
        .res-item { background: var(--card); font-size: 11px; padding: 5px; text-align: center; border-radius: 5px; box-shadow: 2px 2px 4px #000; color: var(--accent); }

        /* SECTION GRAPHIQUE R√âDUITE */
        .box-chart { 
            background: var(--bg); 
            border-radius: 15px; 
            padding: 8px; 
            margin-bottom: 10px;
            height: 100px; /* Espace r√©duit */
        }

        .box-pred { background: #252545; padding: 10px; border-radius: 15px; display: flex; justify-content: space-around; font-size: 12px; }
        .stat-label { color: #888; display: block; font-size: 9px; }
        .stat-val { font-size: 16px; font-weight: bold; color: var(--accent); }
    </style>
</head>
<body>

<div class="container">
    <h2>üéØ MEGAWHEEL TRACKER</h2>

    <div class="input-group">
        <select id="numSelect">
            <option value="">N¬∞</option>
            <option>1</option><option>2</option><option>5</option><option>8</option>
            <option>10</option><option>15</option><option>20</option><option>30</option><option>40</option>
        </select>
        <button class="btn add" onclick="addNum()">AJOUTER</button>
    </div>

    <div class="btn-row">
        <button class="btn pred" onclick="runAnalysis()">üîç ANALYSE</button>
        <button class="btn simu" onclick="runSimu()">üìä SIMU 5000</button>
    </div>

    <div class="tabs">
        <button id="b1" class="tab-btn active" onclick="setTab(1)">1-500</button>
        <button id="b2" class="tab-btn" onclick="setTab(2)">501-1k</button>
        <button id="b3" class="tab-btn" onclick="setTab(3)">Archives</button>
    </div>

    <div class="box-history">
        <div style="font-size: 10px; margin-bottom: 5px; color: #888;">HISTORIQUE (<span id="count">0</span>/5000)</div>
        <div id="grid" class="res-grid"></div>
    </div>

    <div class="box-chart">
        <canvas id="chart"></canvas>
    </div>

    <div class="box-pred">
        <div><span class="stat-label">PROBABLE</span><span id="v-top" class="stat-val">-</span></div>
        <div><span class="stat-label">EN RETARD</span><span id="v-late" class="stat-val">-</span></div>
        <div><span class="stat-label">PATTERN</span><span id="v-pat" class="stat-val" style="font-size:12px">-</span></div>
    </div>

    <button class="btn reset" onclick="clearData()">RESET COMPLET</button>
</div>

<script>
    let results = JSON.parse(localStorage.getItem("mw_final_data")) || [];
    let tab = 1;
    let chartObj = null;

    function save() { localStorage.setItem("mw_final_data", JSON.stringify(results)); }

    function addNum() {
        let n = document.getElementById("numSelect").value;
        if(!n) return;
        results.unshift(parseInt(n));
        if(results.length > 5000) results.pop();
        save();
        update();
    }

    function runSimu() {
        const v = [1,2,5,8,10,15,20,30,40];
        results = [];
        for(let i=0; i<5000; i++) {
            results.push(v[Math.floor(Math.random()*v.length)]);
        }
        save();
        update();
    }

    function setTab(t) {
        tab = t;
        document.querySelectorAll('.tab-btn').forEach((b, i) => b.classList.toggle('active', i+1 === t));
        update();
    }

    function update() {
        document.getElementById("count").innerText = results.length;
        const grid = document.getElementById("grid");
        
        let slice = [];
        if(tab===1) slice = results.slice(0, 500);
        else if(tab===2) slice = results.slice(500, 1000);
        else slice = results.slice(1000, 5000);

        grid.innerHTML = slice.map(n => `<div class="res-item">${n}</div>`).join('');
        
        drawChart();
        runAnalysis();
    }

    function drawChart() {
        const labels = [1,2,5,8,10,15,20,30,40];
        const counts = labels.map(l => results.filter(r => r === l).length);
        
        const ctx = document.getElementById('chart').getContext('2d');
        if(chartObj) chartObj.destroy();
        
        chartObj = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{ data: counts, backgroundColor: '#4ecca3', borderRadius: 4 }]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: { 
                    x: { ticks: { color: '#666', font: { size: 9 } }, grid: { display: false } },
                    y: { display: false }
                }
            }
        });
    }

    function runAnalysis() {
        if(results.length < 2) return;
        let freq = {};
        results.forEach(n => freq[n] = (freq[n]||0) + 1);
        let sorted = Object.entries(freq).sort((a,b) => b[1]-a[1]);
        
        document.getElementById("v-top").innerText = sorted[0] ? sorted[0][0] : "-";
        document.getElementById("v-late").innerText = sorted.length > 1 ? sorted[sorted.length-1][0] : "-";
        document.getElementById("v-pat").innerText = results.slice(0,3).reverse().join(">");
    }

    function clearData() {
        if(confirm("Effacer 5000 tours ?")) {
            results = [];
            save();
            update();
        }
    }

    // Initialisation forc√©e
    window.onload = update;
</script>

</body>
</html>
